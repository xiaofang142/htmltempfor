<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">
    <title>Grids</title>
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet">
    <link href="css/sbcom.css" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body class="sticky-header">
    <section>
        <!-- left side start-->
        <!-- left side end-->
        <!-- main content start-->
        <div class="main-content" style="margin-left:0;">
            <!-- header section start-->
            <div class="header-section" style="left:0;">
                <!--toggle button start-->
                <!--<a class="toggle-btn"><i class="fa fa-bars"></i></a>-->
                <!--toggle button end-->
                <!--search start-->
                <!--<form class="searchform" action="index.html" method="post">
                    <input type="text" class="form-control" name="keyword" placeholder="Search here..." />
                </form>-->
                <!--search end-->
                <!--notification menu start -->
                <div class="menu-right" style="margin-right:0;">
                    <ul class="notification-menu">
                        <li>
                            <a href="#" class="btn btn-default dropdown-toggle info-number">
                                <i class="fa fa-sign-in"></i>
                                登录
                            </a>
                        </li>
                        <li>
                            <a href="#" class="btn btn-default dropdown-toggle info-number">
                                <i class="fa fa-bars"></i>
                                注册
                            </a>
                        </li>
                        <!--<li>
                            <a href="#" class="btn btn-default dropdown-toggle info-number">
                                <i class="fa fa-user"></i>
                                username
                            </a>
                        </li>
                        <li>
                            <a href="#" class="btn btn-default dropdown-toggle info-number">
                                <i class="fa fa-heart"></i>
                                收藏
                            </a>
                        </li>
                        <li>
                            <a href="#" class="btn btn-default dropdown-toggle info-number">
                                <i class="fa fa-sign-out"></i>
                                注销
                            </a>
                        </li>-->


                    </ul>
                </div>
                <!--notification menu end -->
            </div>
            <!-- header section end-->
            <!-- page heading start-->
            <!--<div class="page-heading">
                Bootstrap grid system
            </div>-->
            <!-- page heading end-->
            <!--body wrapper start-->
            <section class="wrapper">
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-lg-3">
                        <div class="input-group m-bot15">
                            <span class="input-group-addon">分类</span>
                            <select class="form-control">
                                <option>Option 1</option>
                                <option>Option 2</option>
                                <option>Option 3</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-lg-3">
                        <div class="input-group m-bot15">
                            <div class="input-group-btn">
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">检索标题<span class="caret"></span></button>
                                <ul class="dropdown-menu">
                                    <li><a href="#">检索标题</a></li>
                                    <li><a href="#">智能模糊</a></li>
                                </ul>
                            </div>
                            <input type="text" class="form-control">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button">搜索</button>
                            </span>
                        </div>
                    </div>
                </div>


                <div id="imglist" class="row">
                    <div id="coltem" mark="coltem" class="col-lg-2 col-sm-3 col-xs-6 sb-imglist">
                        <div id="imgitemtem" class="sb-imgitem hidden">
                            <img src="" />
                            <span></span>
                        </div>
                    </div>
                </div>

                <div id="loading" class="row hidden" loadnum="0">
                    <div class="col-xs-12">
                        <div class="sb-loading">
                            正在加载......
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">查看详细</h4>
                            </div>
                            <div class="modal-body row">
                                <iframe id="detail-body" src="" frameborder="0"></iframe>
                            </div>
                        </div>
                    </div>
                </div>

            </section>
            <!--body wrapper end-->
            <!--footer section start-->
            <!--<footer>
                珠光宝气
            </footer>-->
            <!--footer section end-->

        </div>
        <!-- main content end-->
    </section>
    <!-- Placed js at the end of the document so the pages load faster -->
    <script src="js/jquery-1.10.2.min.js"></script>
    <!--<script src="js/jquery-ui-1.9.2.custom.min.js"></script>-->
    <!--<script src="js/jquery-migrate-1.2.1.min.js"></script>-->
    <script src="js/bootstrap.min.js"></script>
    <!--<script src="js/modernizr.min.js"></script>-->
    <!--<script src="js/jquery.nicescroll.js"></script>-->
    <!--common scripts for all pages-->
    <!--<script src="js/scripts.js"></script>-->

    <script type="text/javascript">
        $(function () {
            LoadColNum();

            AppendImgItem(GetImgList());

            BindScrollBottom();

        });

        //绑定滚动事件
        function BindScrollBottom() {
            window.onscroll = function () {
                var sHeight = document.documentElement.scrollTop || document.body.scrollTop;//滚动高度
                var wHeight = document.documentElement.clientHeight;//window
                var dHeight = document.documentElement.offsetHeight;//整个文档高度
                var differ = dHeight - (sHeight + wHeight);
                if (differ == 0 || differ == -15) {
                    console.log(differ);
                    $("#loading").removeClass("hidden");
                    AppendImgItem(GetImgList());
                }
            };
        }


        //加载列数
        function LoadColNum() {

            var imglistWidth = $("#imglist")[0].scrollWidth;
            var coltemWidth = $("#coltem")[0].scrollWidth;
            var colNum = Math.round(imglistWidth / coltemWidth);
            $("#imglist").attr("colNum", colNum);

            var coltemObj = $("#coltem").clone().removeAttr("id").html("");
            for (var i = 0; i < colNum - 1; i++) {
                var col = coltemObj.clone();
                $("#imglist").append(col);
            }

            //$("#imglist").hide();
        }

        //追加图片项
        function AppendImgItem(imgListJson) {
            if (imgListJson && imgListJson.length > 0) {
                var cols = $("#imglist div[mark=coltem]");
                var imgItemTem = $("#imgitemtem").clone().removeClass("hidden");

                //寻找高度最小的列
                var minHeightCol = cols[0];
                for (var i = 1; i < cols.length; i++) {
                    if (minHeightCol.scrollHeight > cols[i].scrollHeight) {
                        minHeightCol = cols[i];
                    }
                }
                //组装图片项
                var imgItemObj = imgItemTem.clone();
                imgItemObj.attr("id", imgListJson[0].id).attr("url", imgListJson[0].url);
                imgItemObj.children("img").attr("src", imgListJson[0].imgSrc);
                imgItemObj.children("span").html(imgListJson[0].title);

                imgListJson.splice(0, 1);
                //图片项完成加载后继续追加
                imgItemObj.children("img").data("imgList", imgListJson).load(function () {
                    var imgList = $(this).data("imgList");
                    AppendImgItem(imgList);
                });
                imgItemObj.click(function () {
                    var id = $(this).attr("id");
                    var url = $(this).attr("url");


                    var modalMarginTop = parseInt($(".modal-dialog").css("marginTop"));
                    var height = $(window).height() - modalMarginTop * 2 - 55 - 40 - 7;

                    $("#detail-body").attr("src", url);
                    $("#detail-body").css({ "height": height, "width": "100%" });

                    $('#myModal').modal('show');

                });

                //将图片项追加到高度最小的列
                $(minHeightCol).append(imgItemObj);

            }
            $("#loading").removeClass("hidden");
        }

        function GetImgList() {
            //已加载次数
            var loadNum = $("#loading").attr("loadNum");
            //第loadIndex次加载
            var loadIndex = Number(loadNum) + 1;
            $("#loading").attr("loadNum", loadIndex);

            console.log("第" + loadIndex + "次加载");

            var url = "http://img.showybling.com/plus/list.php?tid=74&TotalResult=5220&PageNo=2";
            url = "Details.html";
            $.get(url, null, function (date) {
                var html = date;
            }, "html");

            var json = [{ "id": "123456", "imgSrc": "images/avatar-mini.jpg", "title": "avatar-mini", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/login-bg.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/blog-wide-img.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/image3.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image4.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/500-error.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image5.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/logo.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/avatar-mini.jpg", "title": "avatar-mini", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/login-bg.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/blog-wide-img.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/image3.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image4.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/logo.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/500-error.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image5.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/avatar-mini.jpg", "title": "avatar-mini", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image5.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/avatar-mini.jpg", "title": "avatar-mini", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/login-bg.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/logo.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/blog-wide-img.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/image3.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image4.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/500-error.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image5.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/avatar-mini.jpg", "title": "avatar-mini", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/login-bg.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/blog-wide-img.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/blog/image3.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image4.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/500-error.png", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/gallery/image5.jpg", "title": "xxxx", "url": "Details.html" },
                       { "id": "123456", "imgSrc": "images/logo.png", "title": "xxxx", "url": "Details.html" }];

            return json;
        }

    </script>
</body>
</html>
